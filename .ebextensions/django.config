packages:
  yum:
    gcc: []
    git: []
    gcc-c++: []
    python34-devel: []
    postgresql95-devel: []
    libjpeg-turbo-devel: []

option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: consult_panel.settings.prod
  aws:elasticbeanstalk:container:python:
    WSGIPath: consult_panel/wsgi.py

files:
    "/etc/httpd/conf.d/ssl_rewrite.conf":
        mode: "000644"
        owner: root
        group: root
        content: |
            RewriteEngine On
            <If "-n '%{HTTP:X-Forwarded-Proto}' && %{HTTP:X-Forwarded-Proto} != 'https'">
            RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R,L]
            </If>

container_commands:
  01_yarn_repo_add:
    command: "curl --silent --location https://dl.yarnpkg.com/rpm/yarn.repo | sudo tee /etc/yum.repos.d/yarn.repo"
  02_node_repo_add:
    command: "curl --silent --location https://rpm.nodesource.com/setup_6.x | sudo bash -"
  03_install_yarn:
    command: "yum install -y yarn"
  04_pip_upgrade:
    command: "pip install --upgrade pip"
  10_pip_install:
    command: "pip install -r requirements.txt"
  15_migrate:
    command: "python manage.py migrate"
  16_yarn_install:
    command: "yarn install"
  17_yarn_build:
    command: "yarn build"
  20_collectstatic:
    command: "python manage.py collectstatic --noinput"
  40_wsgipass:
    command: 'echo "WSGIPassAuthorization On" >> ../wsgi.conf'
  50_wsgiappgroup:
    command: 'echo "WSGIApplicationGroup %{GLOBAL}" >> ../wsgi.conf'
