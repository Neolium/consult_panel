{% extends "client_root.html" %}
{% load staticfiles %}

{% block style %}
<link rel="stylesheet" href="{% static 'main/css/lib/fullcalendar/fullcalendar.min.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="alert alert-warning alert-fill alert-close alert-dismissible fade in" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
            <strong>Rappel</strong>
            La convention pour la formation <strong>&laquo;Gestion du temps&raquo;</strong> est en attente de signature.
            <div style="margin-left: 20px;display:inline" class="alert-btns">
                <button type="button" class="btn btn-rounded">Signer</button>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="alert alert-success alert-fill alert-close alert-dismissible fade in" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
            <strong>Catalogue</strong>
            Votre formateur <strong>A&B Consulting</strong> a ajouté 3 formations à votre catalogue.
            <div style="margin-left: 20px;display:inline" class="alert-btns">
                <button type="button" class="btn btn-rounded">Voir</button>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="alert alert-info alert-fill alert-close alert-dismissible fade in" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
            <strong>Suivi</strong>
            Votre formateur <strong>A&B Consulting</strong> a ajouté un suivi pour la formation <strong>&laquo;Adapter ses techniques de vente&raquo;</strong> que vous avez suivie.
            <div style="margin-left: 20px;display:inline" class="alert-btns">
                <button type="button" class="btn btn-rounded">Voir</button>
            </div>
        </div>
    </div>
    
    <section class="box-typical box-typical-max-280">
        <header class="box-typical-header">
            <div class="tbl-row">
                <div class="tbl-cell tbl-cell-title">
                    <h3>Dossiers d'inscriptions en cours de traitement</h3>
                </div>
            </div>
        </header>
        <div class="box-typical-body jspScrollable" tabindex="0" style="overflow: hidden; padding: 0px; width: 100%;">  
            <div class="jspContainer" style="width: 100%; height: 280px;">
                <div class="jspPane" style="padding: 0px; width: 100%;">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <tbody>
                                <tr>
                                    <td>Gestion du temps</td>
                                    <td nowrap="nowrap">
                                        <div class="progress-steps-block">
                                            <div class="progress-steps">
                                                <div class="progress-step active"></div>
                                                <div class="progress-step active"></div>
                                                <div class="progress-step"></div>
                                                <div class="progress-step"></div>
                                            </div>
                                            <div class="progress-steps-caption">En attente de signature par le formateur</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>  
                </div> 
            </div>
        </div><!--.box-typical-body-->
    </section>
</div>
{% endblock %}

{% block script %}
<script src="{% static 'main/js/lib/fullcalendar/fullcalendar.min.js' %}"></script>
<script src="{% static 'main/js/lib/fullcalendar/lang/fr.js' %}"></script>

<script type="text/javascript">

    $(document).ready(function(){

        /* ==========================================================================
         Fullcalendar
         ========================================================================== */

        $('#calendar').fullCalendar({
            timezone: 'Europe/Paris',
            lang: 'fr',
            header: {
                left: '',
                center: 'prev, title, next',
                right: 'today agendaDay, agendaTwoDay, agendaWeek, month'
            },
            buttonIcons: {
                prev: 'font-icon font-icon-arrow-left',
                next: 'font-icon font-icon-arrow-right',
                prevYear: 'font-icon font-icon-arrow-left',
                nextYear: 'font-icon font-icon-arrow-right'
            },
            defaultDate: '2016-01-12',
            editable: true,
            selectable: true,
            eventLimit: true,
            events: [
                {
                    title: 'Marketing Relationnel',
                    start: '2016-01-01T08:30:00'
                },
                {
                    title: 'Communication Digitale',
                    start: '2016-01-07T10:40:00',
                    end: '2016-01-10',
                    className: 'event-green'
                },
                {
                    title: 'Dinner d\'affaire',
                    start: '2016-01-09T12:30:00',
                    className: 'event-red'
                },
                {
                    id: 999,
                    title: 'Repeating Event',
                    start: '2016-01-16T16:20:00',
                    className: 'event-orange'
                },
                {
                    title: 'Conference Viplo',
                    start: '2016-01-11T14:30:00',
                    end: '2016-01-13',
                    className: 'event-coral'
                },
                {
                    title: 'Meeting',
                    start: '2016-01-12T10:30:00',
                    end: '2016-01-12T12:30:00',
                    className: 'event-green'
                },
                {
                    title: 'Lunch',
                    start: '2016-01-12T12:00:00'
                },
                {
                    title: 'Meeting',
                    start: '2016-01-12T14:30:00',
                    className: 'event-red'
                },
                {
                    title: 'Happy Hour',
                    start: '2016-01-12T17:30:00'
                },
                {
                    title: 'Dinner',
                    start: '2016-01-12T20:00:00',
                    className: 'event-orange'
                },
                {
                    title: 'Formation',
                    start: '2016-01-13T10:40:00'
                },
                {
                    title: 'Marketing Relationnel',
                    start: '2016-01-28T14:30:00',
                    className: 'event-coral'
                }
            ],
            viewRender: function(view, element) {
                if (!("ontouchstart" in document.documentElement)) {
                    $('.fc-scroller').jScrollPane({
                        autoReinitialise: true,
                        autoReinitialiseDelay: 100
                    });
                }

                $('.fc-popover.click').remove();
            },
            eventClick: function(calEvent, jsEvent, view) {

                var eventEl = $(this);

                // Add and remove event border class
                if (!$(this).hasClass('event-clicked')) {
                    $('.fc-event').removeClass('event-clicked');

                    $(this).addClass('event-clicked');
                }

                // Add popover
                $('body').append(
                        '<div class="fc-popover click">' +
                        '<div class="fc-header">' +
                        moment(calEvent.start).format('dddd • D') +
                        '<button type="button" class="cl"><i class="font-icon-close-2"></i></button>' +
                        '</div>' +

                        '<div class="fc-body main-screen">' +
                        '<p>' +
                        moment(calEvent.start).format('dddd, D YYYY, hh:mma') +
                        '</p>' +
                        '<p class="color-blue-grey">Name Surname Patient<br/>Surgey ACL left knee</p>' +
                        '<ul class="actions">' +
                        '<li><a href="#">More details</a></li>' +
                        '<li><a href="#" class="fc-event-action-edit">Edit event</a></li>' +
                        '<li><a href="#" class="fc-event-action-remove">Remove</a></li>' +
                        '</ul>' +
                        '</div>' +

                        '<div class="fc-body remove-confirm">' +
                        '<p>Are you sure to remove event?</p>' +
                        '<div class="text-center">' +
                        '<button type="button" class="btn btn-rounded btn-sm">Yes</button>' +
                        '<button type="button" class="btn btn-rounded btn-sm btn-default remove-popover">No</button>' +
                        '</div>' +
                        '</div>' +

                        '<div class="fc-body edit-event">' +
                        '<p>Edit event</p>' +
                        '<div class="form-group">' +
                        '<div class="input-group date datetimepicker">' +
                        '<input type="text" class="form-control" />' +
                        '<span class="input-group-addon"><i class="font-icon font-icon-calend"></i></span>' +
                        '</div>' +
                        '</div>' +
                        '<div class="form-group">' +
                        '<div class="input-group date datetimepicker-2">' +
                        '<input type="text" class="form-control" />' +
                        '<span class="input-group-addon"><i class="font-icon font-icon-clock"></i></span>' +
                        '</div>' +
                        '</div>' +
                        '<div class="form-group">' +
                        '<textarea class="form-control" rows="2">Name Surname Patient Surgey ACL left knee</textarea>' +
                        '</div>' +
                        '<div class="text-center">' +
                        '<button type="button" class="btn btn-rounded btn-sm">Save</button>' +
                        '<button type="button" class="btn btn-rounded btn-sm btn-default remove-popover">Cancel</button>' +
                        '</div>' +
                        '</div>' +
                        '</div>'
                        );

                // Datepicker init
                $('.fc-popover.click .datetimepicker').datetimepicker({
                    widgetPositioning: {
                        horizontal: 'right'
                    }
                });

                $('.fc-popover.click .datetimepicker-2').datetimepicker({
                    widgetPositioning: {
                        horizontal: 'right'
                    },
                    format: 'LT',
                    debug: true
                });


                // Position popover
                function posPopover(){
                    $('.fc-popover.click').css({
                        left: eventEl.offset().left + eventEl.outerWidth()/2,
                        top: eventEl.offset().top + eventEl.outerHeight()
                    });
                }

                posPopover();

                $('.fc-scroller, .calendar-page-content, body').scroll(function(){
                    posPopover();
                });

                $(window).resize(function(){
                    posPopover();
                });


                // Remove old popover
                if ($('.fc-popover.click').length > 1) {
                    for (var i = 0; i < ($('.fc-popover.click').length - 1); i++) {
                        $('.fc-popover.click').eq(i).remove();
                    }
                }

                // Close buttons
                $('.fc-popover.click .cl, .fc-popover.click .remove-popover').click(function(){
                    $('.fc-popover.click').remove();
                    $('.fc-event').removeClass('event-clicked');
                });

                // Actions link
                $('.fc-event-action-edit').click(function(e){
                    e.preventDefault();

                    $('.fc-popover.click .main-screen').hide();
                    $('.fc-popover.click .edit-event').show();
                });

                $('.fc-event-action-remove').click(function(e){
                    e.preventDefault();

                    $('.fc-popover.click .main-screen').hide();
                    $('.fc-popover.click .remove-confirm').show();
                });
            }
        });

    });


    /* ==========================================================================
     Calendar page grid
     ========================================================================== */

    (function($, viewport){
        $(document).ready(function() {

            if(viewport.is('>=lg')) {
                $('.calendar-page-content, .calendar-page-side').matchHeight();
            }

            // Execute code each time window size changes
            $(window).resize(
                    viewport.changed(function() {
                        if(viewport.is('<lg')) {
                            $('.calendar-page-content, .calendar-page-side').matchHeight({ remove: true });
                }
            })
                    );
        });
    })(jQuery, ResponsiveBootstrapToolkit);

</script>

{% endblock %}
